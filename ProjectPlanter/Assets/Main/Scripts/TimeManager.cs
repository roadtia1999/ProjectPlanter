using UnityEngine;
using System;

public class TimeManager : MonoBehaviour
{
    // 게임 시작 시간
    public DateTime lastTime;

    // 게임 이어서 시작한 시간
    public DateTime keepStartTime;

    public DateTime GameTime;

    // 저장된 데이터 있는지 확인 
    private bool IsSave;


    void Start()
    {
        // SavedTime 있는지 찾기
        IsSave = PlayerPrefs.HasKey("SavedTime");

        // save가 없다면 만일을 위해 time 초기화.
        if (!IsSave)
        {
            Debug.Log("저장된 데이터가 없습니다.");
            
        }

        // 게임 다시 시작시 시간 저장 
        // --> 알파값과 비교 후 경과 시간만큼 트리거 작동.
        string startDateTimeString = DateTime.Now.ToString();
        Debug.Log(startDateTimeString + "    다시 시작 값 저장");
        PlayerPrefs.SetString("KeepSavedTime", startDateTimeString);


        // 알파
        // 이전에 저장된 시간 불러오기
        // 시작시 전에 종료 시간 불러오기 확인.
        string savedTimeString = PlayerPrefs.GetString("SavedTime");
        Debug.Log(savedTimeString + "   저장시간 불러오기");


        if (!string.IsNullOrEmpty(savedTimeString))
        {
            // 이전에 저장된 시간이 있다면 불러와서 DateTime으로 변환
            lastTime = DateTime.Parse(savedTimeString);

            // 현재 시작 시간도 DateTime으로 변환
            DateTime startTime = DateTime.Parse(startDateTimeString);

            // 시간 차이 계산
            TimeSpan timeDifference = startTime - lastTime;

            // 시간 차이 출력
            Debug.Log("시간 차이: " + timeDifference);

            /*// 시간 차이가 1시간 이상일 때 랜덤 이벤트 발생
            if (timeDifference.TotalHours >= 1)
            {
                TriggerRandomEvent();
            }*/

        }
      
    }
    // 알파
    // 종료시 타임 저장 메서드
    void OnApplicationQuit()
    {
        // 게임 종료 시 현재 시간 저장
        string lastDateTimeString = DateTime.Now.ToString();
        // 종료시에 시간 저장 확인.
        Debug.Log(lastDateTimeString + "    종료시간 저장");
        PlayerPrefs.SetString("SavedTime", lastDateTimeString);
    }

/*    void Update()
    {
        // 게임이 진행되는 동안의 경과 시간
        TimeSpan elapsedTime = DateTime.Now - gameStartTime;

        // 여기서 경과 시간을 필요한 형태로 사용할 수 있습니다.
        Debug.Log("Elapsed time: " + elapsedTime);
    }*/
}